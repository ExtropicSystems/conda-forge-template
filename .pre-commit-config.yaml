repos:
- repo: https://github.com/pre-commit/pre-commit-hooks
  rev: v4.1.0
  hooks:
  - id: check-added-large-files
  - id: check-case-conflict
  - id: check-merge-conflict
  - id: check-symlinks
# XXXADS check-yaml is disabled as it doesn't like the meta commands
# in packaging/conda/meta.yaml. e.g. they have the following form: {% ... %}
#  - id: check-yaml
  - id: debug-statements
  - id: end-of-file-fixer
  - id: mixed-line-ending
  - id: requirements-txt-fixer
  - id: trailing-whitespace

- repo: https://github.com/ambv/black
  rev: stable
  hooks:
    - id: black
      language_version: python3.8
      args: ['--config=pyproject.toml']

- repo: https://github.com/pre-commit/mirrors-clang-format
  rev: v13.0.0
  hooks:
   - id: clang-format
     args: ['-i']

- repo: https://github.com/doublify/pre-commit-rust
  rev: v1.0
  hooks:
    - id: fmt
      args: ['--manifest-path', 'src/rust/Cargo.toml']
      pass_filenames: false

- repo: https://github.com/doublify/pre-commit-rust
  rev: v1.0
  hooks:
    - id: cargo-check
      args: ['--manifest-path', 'src/rust/Cargo.toml']

- repo: https://github.com/mgedmin/check-manifest
  rev: "0.47"
  hooks:
  - id: check-manifest
    args: ['--ignore', 'noxfile.py,src/python/project/tests/**,*.so']

# XXXADS issue with setuptools-rust dependency. I think its a conflict with
# how databricks tracks the python env combined with how nox builds its
# venv.

#- repo: local
#  hooks:
#  - id: setup-py-check
#    name: setup.py check -m -s
#    language: system
#    entry: bash -c 'python setup.py check -m -s'

- repo: https://github.com/pycqa/flake8
  rev: 4.0.1
  hooks:
  - id: flake8
    args: ['src/python']

- repo: local
  hooks:
  - id: cppcheck
    name: cppcheck - c++ linter
    language: system
    entry: bash -c 'cppcheck --enable=warning,performance,portability,information,missingInclude -I/databricks/python3/lib/python3.8/site-packages/pybind11/include/ --suppress=preprocessorErrorDirective:/databricks/python3/lib/python3.8/site-packages/pybind11/include/pybind11/detail/common.h --std=c++20 -UVERSION_INFO --check-config ./src/cxx'

- repo: local
  hooks:
  - id: clippy
    name: cargo clippy - rust linter
    language: system
    entry: bash -c 'cd src/rust && cargo clippy'

